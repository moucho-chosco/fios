<!DOCTYPE html>
<html lang="gl">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espazos</title>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
    <div class="container">
        
        <aside class="sidebar-container">
            <div class="sidebar">
    <div class="logo">
        <a href="/"><img src="/images/logo.svg" alt="Logo do sitio"></a>
    </div>
    <nav>
        <ul>
            
            <li class="">
                <a href="/" class="menu-link">
                    Principal
                </a>
            </li>
            
            <li class="">
                <a href="/biblioteca/" class="menu-link">
                    Biblioteca
                </a>
            </li>
            
            <li class="">
                <a href="/organizacions/" class="menu-link">
                    Organizacións
                </a>
            </li>
            
            <li class="active">
                <a href="/espazos/" class="menu-link">
                    Espazos
                </a>
            </li>
            
            <li class="">
                <a href="/calendario/" class="menu-link">
                    Calendario
                </a>
            </li>
            
            <li class="">
                <a href="/convocatorias/" class="menu-link">
                    Convocatorias
                </a>
            </li>
            
            <li class="">
                <a href="/podcast/" class="menu-link">
                    Podcast
                </a>
            </li>
            
            <li class="">
                <a href="/redes/" class="menu-link">
                    Redes
                </a>
            </li>
            
            <li class="">
                <a href="/recursos/" class="menu-link">
                    Recursos
                </a>
            </li>
            
        </ul>
    </nav>
</div>

        </aside>

        
        <main class="content">
            
<h1>Espazos e Centros Sociais</h1>


<select id="localidade-filter">
  <option value="galiza,42.7751,-8.0339,8.4">Galiza</option>
  
    <option value="a_corunha,43.3627,-8.4065,14">A Coruña</option>
  
    <option value="lugo,43.007666,-7.553,15">Lugo</option>
  
    <option value="pontevedra,42.4325,-8.645,15">Pontevedra</option>
  
    <option value="compostela,42.879,-8.544,15">Santiago de Compostela</option>
  
    <option value="vigo,42.237878,-8.718482,13">Vigo</option>
  
</select>



<div id="map" style="height: 80vh;"></div>


<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.maptiler.com/maptiler-sdk-js/v2.3.0/maptiler-sdk.umd.js"></script>
<link href="https://cdn.maptiler.com/maptiler-sdk-js/v2.3.0/maptiler-sdk.css" rel="stylesheet" />
<script src="https://cdn.maptiler.com/leaflet-maptilersdk/v2.0.0/leaflet-maptilersdk.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

<script>
  const key = 'dc5wAmsD5MUwi9LdDQ1I';

  
  const map = L.map('map', {
  maxZoom: 18,
  minZoom: 8 
  }).setView([42.7751, -8.0339], 8);
  const mtLayer = L.maptilerLayer({
    apiKey: key,
    style: "17bb7529-f38c-48ce-b98f-4ca2cc7ef3cb" 
  }).addTo(map);

  
  const localidades = {
    
    "a_corunha": {
      title: "A Coruña",
      lat:  43.3627 ,
      lon:  -8.4065 ,
      zoom:  14 
    },
    
    "lugo": {
      title: "Lugo",
      lat:  43.007666 ,
      lon:  -7.553 ,
      zoom:  15 
    },
    
    "pontevedra": {
      title: "Pontevedra",
      lat:  42.4325 ,
      lon:  -8.645 ,
      zoom:  15 
    },
    
    "compostela": {
      title: "Santiago de Compostela",
      lat:  42.879 ,
      lon:  -8.544 ,
      zoom:  15 
    },
    
    "vigo": {
      title: "Vigo",
      lat:  42.237878 ,
      lon:  -8.718482 ,
      zoom:  13 
    },
    
  };

  
  const localidadeFilter = document.getElementById('localidade-filter');
  localidadeFilter.addEventListener('change', () => {
    const value = localidadeFilter.value.split(',');
    const [key, lat, lon, zoom] = value;
    if (localidades[key]) {
    const { lat, lon, zoom } = localidades[key];
    map.setView([lat, lon], zoom);
  } else if (key === "galiza") {
    
    map.setView([42.7751, -8.0339], 8.4);
  }
});

const espazos = [
  
    {
      title: "A Fenda",
      description: "Centro Socialista",
      location: { lat:  43.364293 , lon:  -8.424243  }
    },
  
    {
      title: "A Revolteira",
      description: "Espazo Autoxestionado na Coruña.",
      location: { lat:  43.358728281851086 , lon:  -8.40653158003866  }
    },
  
    {
      title: "CS A Pedreira",
      description: "Espazo Autoxestionado en Pontevedra.",
      location: { lat:  42.43384550029501 , lon:  -8.642724439978007  }
    },
  
    {
      title: "CSOA Escárnio e Maldizer",
      description: "Centro Social Ocupado Autoxestionado",
      location: { lat:  42.88169616573114 , lon:  -8.54240060014547  }
    },
  
    {
      title: "O Pichel",
      description: "Espaço autogerido em Compostela.",
      location: { lat:  42.88625047468636 , lon:  -8.540730891640834  }
    },
  
    {
      title: "Xebra!",
      description: "Associaçom cultural",
      location: { lat:  43.662024 , lon:  -7.358252  }
    },
  
];

const iconWithNumber = L.divIcon({
  html: `<div style="background: black; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">1</div>`,
  className: 'custom-marker',
  iconSize: [30, 30]
});

const simpleIcon = L.divIcon({
  html: `<div style="background: black; width: 12px; height: 12px; border-radius: 50%;"></div>`,
  className: 'simple-marker',
  iconSize: [30, 30]
});


const markers = L.markerClusterGroup({
  iconCreateFunction: (cluster) => {
    const count = cluster.getChildCount();
    return L.divIcon({
      html: `<div style="background: black; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">${count}</div>`,
      className: 'cluster-icon',
      iconSize: [30, 30]
    });
  },
  maxClusterRadius: 40, 
  disableClusteringAtZoom: 16 
});


const leafletMarkers = [];
espazos.forEach(espazo => {
  if (espazo.location && espazo.location.lat !== undefined && espazo.location.lon !== undefined) {
    
    const marker = L.marker([espazo.location.lat, espazo.location.lon], {
      icon: L.divIcon({
        html: `<div style="background: black; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">1</div>`,
        className: 'custom-marker',
        iconSize: [30, 30]
      })
    });

    
    marker.bindPopup(`<strong>${espazo.title}</strong><br>${espazo.description}`);
    leafletMarkers.push(marker);

    
    marker.on('click', () => {
      map.setView([espazo.location.lat, espazo.location.lon], 16); 
    });
    

    
    markers.addLayer(marker);
  }
});


map.addLayer(markers);


map.on('zoomend', () => {
  const zoomLevel = map.getZoom();
  const iconToUse = zoomLevel >= 13 ? simpleIcon : iconWithNumber;

  leafletMarkers.forEach(marker => {
    marker.setIcon(iconToUse); 
  });
});
</script>


        </main>
    </div>
</body>
</html>
